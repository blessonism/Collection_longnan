# 周小结管理平台

周小结收集、AI 校对、批量归档一体化平台。

## 功能

- 在线填写周小结（格式由模板控制）
- AI 内容校对（规则检查 + AI 语义检查）
- 一键修复校对问题
- 导出标准格式 Word 文档
- 批量归档打包下载
- 管理员配置面板（自定义规则和 Prompt）

## 技术栈

- 后端：Python + FastAPI + SQLite
- 前端：React + TypeScript + Tailwind CSS + shadcn/ui
- AI：DeepSeek API

---

## 校对处理 Pipeline

校对采用**规则检查 + AI 检查**双层架构，先快后慢，分工明确。

```
用户内容 → 规则检查器(rule_checker) → AI检查器(deepseek_checker) → 合并去重 → 返回结果
```

### 第一层：规则检查器（快速、确定性）

处理明确的格式和标点规则，不需要 AI，用代码逻辑直接检测。

| 检测项 | 规则 | 示例 |
|--------|------|------|
| 序号格式 | 必须是 `1.` 格式 | `1、` → `1.`，`1。` → `1.`，`1. ` → `1.` |
| 英文逗号 | 转中文逗号 | `,` → `，` |
| 英文分号 | 转中文分号 | `;` → `；` |
| 英文冒号 | 转中文冒号（排除时间格式） | `:` → `：` |
| 英文问号 | 转中文问号 | `?` → `？` |
| 英文感叹号 | 转中文感叹号 | `!` → `！` |
| 英文括号 | 括号内有中文时转中文括号 | `(内容)` → `（内容）` |
| 斜杠 | 中文语境中转分号 | `工作/会议` → `工作；会议` |
| 连续标点 | 去除重复 | `。。` → `。` |
| 句末标点 | 每条必须以句号结尾 | `；` → `。`，无句号则提醒添加 |
| 多余空格 | 中文间不应有空格 | `工作 内容` → `工作内容` |

### 第二层：AI 检查器（语义理解）

处理需要语义理解的问题，调用 DeepSeek API。

| 检测项 | 说明 | 示例 |
|--------|------|------|
| 错别字 | 明确的错字 | `按排` → `安排`，`工做` → `工作` |
| 标点语义 | 独立任务间应用分号而非逗号 | `梳理材料，参加会议` → `梳理材料；参加会议` |

**AI 检查原则：**
- 宁可漏报，不可误报
- 不检查专有名词（地名、人名、机构名）
- 不做"优化建议"或"补充完善"

### 公文标点规范要点

1. **分号 `；`** 用于分隔同一条内的并列事项
2. **句号 `。`** 用于每条工作的结尾
3. **`。；` 组合**是正确的公文写法（前一事项结束，后接并列事项）
4. **冒号 `：`** 用于总述后引出具体内容，不要改成分号

---

## Word 导出格式

严格匹配模板 `周小结模板/凌声明周小结-11.29-12.5.docx`：

| 元素 | 字体 | 字号 | 其他 |
|------|------|------|------|
| 标题 | 方正小标宋简体 | 22磅 | 居中 |
| 姓名 | 仿宋_GB2312 | 16磅（三号） | 居中 |
| 区块标题 | 黑体 | 16磅（三号） | 首行缩进2字符 |
| 正文 | 仿宋_GB2312 | 16磅（三号） | 首行缩进2字符 |
| 空行 | - | 16磅（三号） | 姓名后、下周计划前 |

**页面设置：**
- 行距：固定值 28 磅
- 页边距：上 3.7cm，下 3.5cm，左右 2.8cm

---

## 快速开始

### 1. 配置环境变量

```bash
cd backend
cp .env.example .env
# 编辑 .env，填入 DeepSeek API Key
```

### 2. 启动后端

```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload
```

### 3. 启动前端

```bash
cd frontend
npm install
npm run dev
```

### 4. 访问

打开 http://localhost:5173

## API 文档

启动后端后访问 http://localhost:8000/docs

---

## 管理员配置

点击页面右上角的设置图标进入管理员面板。

**默认账号：**
- 用户名：`admin`
- 密码：`admin123`

可在 `.env` 文件中修改：
```
ADMIN_USERNAME=your_username
ADMIN_PASSWORD=your_password
```

**可配置项：**

| 配置项 | 说明 |
|--------|------|
| 规则检查开关 | 启用/禁用各项规则检查（序号格式、标点、空格等） |
| AI 检查开关 | 启用/禁用错别字检查、标点语义检查 |
| System Prompt | 自定义 AI 的行为和检查规则 |

---

## 项目结构

```
backend/
├── app/
│   ├── services/
│   │   ├── checker/
│   │   │   ├── rule_checker.py     # 规则检查器
│   │   │   ├── deepseek_checker.py # AI检查器
│   │   │   └── config_loader.py    # 配置加载器
│   │   ├── exporter.py             # Word导出
│   │   └── archiver.py             # 批量归档
│   ├── routers/
│   │   ├── check.py                # 校对接口
│   │   ├── form.py                 # 表单接口
│   │   └── admin.py                # 管理员接口
│   ├── models/
│   │   ├── submission.py           # 提交记录模型
│   │   └── config.py               # 系统配置模型
│   └── ...
frontend/
├── src/
│   ├── components/
│   │   ├── SummaryForm.tsx         # 主表单组件
│   │   └── AdminPanel.tsx          # 管理员面板
│   └── ...
```
