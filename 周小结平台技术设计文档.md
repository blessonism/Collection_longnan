# 周小结管理平台 - 技术设计文档

## 一、平台概述

### 1.1 目标
搭建一个轻量级平台，实现周小结的统一收集、自动校对、批量归档功能。

### 1.2 核心功能
- 文件上传：领导上传周小结文档
- 自动校对：格式、标点、错字自动检测
- 提交追踪：查看谁交了、谁没交
- 批量归档：自动重命名、打包下载

### 1.3 技术栈
| 层级 | 技术选型 |
|------|----------|
| 前端 | React + TypeScript + shadcn/ui + Tailwind CSS |
| 后端 | Python + FastAPI |
| 文档处理 | python-docx |
| 校对引擎 | pycorrector + 正则表达式 |
| 数据存储 | SQLite（轻量）/ PostgreSQL（可选） |
| 文件存储 | 本地文件系统 / MinIO（可选） |

---

## 二、系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                         前端 (React)                         │
├─────────────────────────────────────────────────────────────┤
│  上传页面  │  校对结果页  │  提交状态页  │  归档下载页       │
└──────────────────────────┬──────────────────────────────────┘
                           │ HTTP/REST API
┌──────────────────────────▼──────────────────────────────────┐
│                      后端 (FastAPI)                          │
├─────────────────────────────────────────────────────────────┤
│  上传接口  │  校对服务  │  状态查询  │  归档打包            │
├─────────────────────────────────────────────────────────────┤
│                      校对引擎                                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                  │
│  │ 格式检查 │  │ 标点检查 │  │ 错字检查 │                  │
│  └──────────┘  └──────────┘  └──────────┘                  │
└─────────────────────────────────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                      数据层                                  │
│  ┌──────────┐  ┌──────────────┐                             │
│  │  SQLite  │  │  文件存储     │                             │
│  └──────────┘  └──────────────┘                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 三、功能模块设计

### 3.1 模块二：统一收集

#### 前端页面
- 上传表单：选择部门/姓名 + 上传文件
- 支持拖拽上传
- 上传进度显示
- 提交状态看板（表格展示谁交了）

#### 后端接口
```
POST /api/upload
  - 参数：file, department, name, week_number
  - 返回：upload_id, status

GET /api/submissions
  - 参数：week_number
  - 返回：提交列表 [{name, department, status, upload_time}]

GET /api/submissions/missing
  - 参数：week_number
  - 返回：未提交人员列表
```

#### 数据模型
```python
class Submission:
    id: int
    week_number: str          # 如 "2024-W50"
    department: str           # 部门
    name: str                 # 姓名
    original_filename: str    # 原始文件名
    stored_filename: str      # 存储文件名
    upload_time: datetime
    status: str               # pending / checked / archived
    check_result: JSON        # 校对结果
```

---

### 3.2 模块三：自动校对

#### 校对规则
| 检查项 | 规则 | 严重程度 |
|--------|------|----------|
| 字体 | 正文宋体/仿宋，标题黑体 | warning |
| 字号 | 正文小四/四号 | warning |
| 行距 | 固定值或1.5倍 | info |
| 中英文标点混用 | 检测英文逗号句号等 | error |
| 连续标点 | 如 。。、，， | error |
| 错别字 | pycorrector 检测 | warning |
| 空格问题 | 多余空格、中英文间空格 | info |

#### 后端接口
```
POST /api/check/{upload_id}
  - 触发校对
  - 返回：check_result

GET /api/check/{upload_id}/result
  - 返回：详细校对报告
```

#### 校对结果结构
```json
{
  "upload_id": 1,
  "total_issues": 5,
  "issues": [
    {
      "type": "punctuation",
      "severity": "error",
      "location": "第3段第2行",
      "content": "工作完成情况,",
      "suggestion": "工作完成情况，"
    },
    {
      "type": "typo",
      "severity": "warning",
      "location": "第5段第1行",
      "content": "按照按排",
      "suggestion": "按照安排"
    }
  ],
  "format_check": {
    "font_ok": false,
    "font_issues": ["第2段使用了微软雅黑，应为仿宋"],
    "size_ok": true,
    "spacing_ok": true
  }
}
```

#### 前端展示
- 问题列表（按严重程度排序）
- 原文高亮标记问题位置
- 一键查看修改建议
- 标记"已处理"功能

---

### 3.3 模块四：批量归档

#### 命名规则配置
```python
# 可配置的命名模板
naming_template = "{序号}_{部门}_{姓名}_周小结_{周次}.docx"
# 示例输出：01_办公室_张三_周小结_2024W50.docx
```

#### 后端接口
```
POST /api/archive
  - 参数：week_number, naming_template
  - 返回：archive_id, file_list

GET /api/archive/{archive_id}/download
  - 返回：ZIP 压缩包

GET /api/archive/{archive_id}/manifest
  - 返回：文件清单（可打印）
```

#### 归档流程
1. 获取指定周次所有已校对文件
2. 按命名规则重命名
3. 按指定顺序排序（可配置排序规则）
4. 打包为 ZIP
5. 生成文件清单（用于打印核对）

---

## 四、目录结构

```
weekly-summary-platform/
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI 入口
│   │   ├── config.py            # 配置
│   │   ├── models/
│   │   │   ├── __init__.py
│   │   │   └── submission.py    # 数据模型
│   │   ├── routers/
│   │   │   ├── __init__.py
│   │   │   ├── upload.py        # 上传接口
│   │   │   ├── check.py         # 校对接口
│   │   │   └── archive.py       # 归档接口
│   │   ├── services/
│   │   │   ├── __init__.py
│   │   │   ├── checker/
│   │   │   │   ├── __init__.py
│   │   │   │   ├── format_checker.py    # 格式检查
│   │   │   │   ├── punctuation_checker.py # 标点检查
│   │   │   │   └── typo_checker.py      # 错字检查
│   │   │   ├── archiver.py      # 归档服务
│   │   │   └── storage.py       # 文件存储
│   │   └── database.py          # 数据库连接
│   ├── uploads/                 # 上传文件存储
│   ├── archives/                # 归档文件存储
│   ├── requirements.txt
│   └── pyproject.toml
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── ui/              # shadcn 组件
│   │   │   ├── upload-form.tsx
│   │   │   ├── submission-table.tsx
│   │   │   ├── check-result.tsx
│   │   │   └── archive-panel.tsx
│   │   ├── pages/
│   │   │   ├── upload.tsx       # 上传页
│   │   │   ├── status.tsx       # 提交状态页
│   │   │   ├── review.tsx       # 校对审核页
│   │   │   └── archive.tsx      # 归档下载页
│   │   ├── lib/
│   │   │   ├── api.ts           # API 调用封装
│   │   │   └── utils.ts
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── package.json
│   └── vite.config.ts
│
└── README.md
```

---

## 五、核心依赖

### 后端 (requirements.txt)
```
fastapi>=0.104.0
uvicorn>=0.24.0
python-multipart>=0.0.6
python-docx>=1.1.0
pycorrector>=0.4.0
sqlalchemy>=2.0.0
aiosqlite>=0.19.0
```

### 前端 (package.json 核心依赖)
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "@tanstack/react-query": "^5.0.0",
    "axios": "^1.6.0",
    "tailwindcss": "^3.3.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.0.0",
    "lucide-react": "^0.294.0"
  }
}
```

---

## 六、开发计划

### Phase 1：基础框架（2天）
- [ ] 后端项目初始化 + FastAPI 基础结构
- [ ] 前端项目初始化 + shadcn 配置
- [ ] 数据库模型设计
- [ ] 文件上传接口

### Phase 2：校对引擎（3天）
- [ ] 格式检查器（字体、字号、行距）
- [ ] 标点检查器（正则规则）
- [ ] 错字检查器（pycorrector 集成）
- [ ] 校对结果 API

### Phase 3：前端页面（3天）
- [ ] 上传页面
- [ ] 提交状态看板
- [ ] 校对结果展示页
- [ ] 归档下载页

### Phase 4：归档功能（1天）
- [ ] 批量重命名
- [ ] ZIP 打包
- [ ] 文件清单生成

### Phase 5：优化完善（1天）
- [ ] 错误处理
- [ ] 加载状态
- [ ] 部署配置

---

## 七、后续扩展

- 用户认证（简单的登录）
- 人员名单管理（配置谁需要交）
- 历史记录查询
- 导出统计报表
- 接入大模型做智能润色

---

## 八、下一步

确认以下信息后可以开始编码：

1. **周小结格式规范**：字体、字号、行距的具体要求
2. **人员名单**：有多少人需要提交？是否需要按部门分组？
3. **命名规则**：归档文件的命名格式偏好
4. **部署环境**：本地运行还是需要部署到服务器？
